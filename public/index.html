<!DOCTYPE html>
<html lang="ja">
<head>
  
  <meta charset="UTF-8">
  <base target="_top">
  <meta name="viewport" content="width=950, user-scalable=no">
  <title>nursery sera - 商品一覧</title>
  <link href="https://fonts.googleapis.com/css2?family=Bayon&family=Tangerine:wght@700&family=Italianno&family=Noto+Serif+JP&display=swap" rel="stylesheet">
  <style>
    /* ===== ベース ===== */
    html,body{
      margin:0;padding:0;font-size:20px;-webkit-text-size-adjust:100%;
      font-family:Arial,sans-serif;background:#fff;color:#333;box-sizing:border-box
    }
    *,*:before,*:after{box-sizing:inherit}
    .container{max-width:1100px;margin:0 auto;padding:0 16px}

    /* ▼ 追加：縦フレックスで“底に吸いつく” */
    html, body { height:100%; }
    body { min-height:100vh; display:flex; flex-direction:column; }
    main { flex:1 0 auto; }           /* 本文が余り高さを受け持つ */
    
    /* ===== ヘッダー ===== */
    .header-bar{
      position:sticky; margin-top:-50px; z-index:1000;
      background:transparent;
      display:flex; align-items:center; justify-content:space-between;
      padding:20px; transition:top .5s ease;
    }
    .menu-icon{
      display:flex; flex-direction:column; justify-content:space-between;
      width:48px; height:40px; cursor:pointer; background:none; border:none;
      padding:0; margin:0; transform:translateX(20px);
    }
    .menu-icon span{
      display:block; height:3px; width:100%; background:#333; border-radius:2px;
    }
    .main-title{
      font-family:'Bayon', cursive;
      font-size:109px; margin:0; white-space:nowrap; transform:translateX(20px);
      cursor:pointer;
opacity:1;color:#333
    }
    .cart-button{
      background-image:url('https://gist.githubusercontent.com/nursery-sera/3bfad5863718f7147d193844bdaca462/raw/d7f9244ea2cbbaf4c13a67c30831022e37076b17/plantcart-icon.svg');
      background-size:contain; background-repeat:no-repeat;
      width:100px; height:100px; border:none; background-color:transparent; cursor:pointer;
    }

    /* ===== メニュー（スライド＋オーバーレイ） ===== */
    .overlay{
      position:fixed; inset:0;             /* ← 100vw/100vh をやめてはみ出し防止 */
      background:rgba(0,0,0,.3); z-index:2000; display:none;
    }
    .overlay.show{ display:block; }

    .category-menu{
      position:fixed; top:0; left:0;
      width:55vw; height:100vh;
      background-color:rgba(255,255,255,.7);
      backdrop-filter:blur(8px);
      z-index:3000;
      border:2px solid rgba(0,0,0,.1);
      box-shadow:4px 0 20px rgba(0,0,0,.2);
      transform:translateX(-100%); opacity:0; pointer-events:none;
      transition:transform .4s ease, opacity .4s ease;
      padding:30px;
    }
    .category-menu.show{
      transform:translateX(0); opacity:1; pointer-events:auto;
    }

    .category-header{
      font-family:'Cinzel', serif;
      font-size:80px; margin-bottom:40px; letter-spacing:3px; color:#000;
      text-align:center;
    }
    .category-menu ul{ list-style:none; padding:0; margin:0; }
    .category-menu li{opacity: 0.8;
font-family: 'Noto Serif JP', serif;
      font-size:36px; margin:20px 0; padding-bottom:10px; position:relative;
      border-bottom:1px solid rgba(0,0,0,.1);
      transition:transform .2s ease, color .2s ease;
      cursor:pointer; font-weight:400; color:#000; text-align:left; padding-right:20px;
    }
    .category-menu li:hover{ color:#c2185b; transform:scale(1.05); }
    .category-menu li::after{
      content:"＞"; position:absolute; right:0; top:2px; color:#bbb; font-size:20px;
    }

    /* ===== フッター ===== */
    footer{
      margin-top:auto; /* ← Flex で“底に吸いつく”（見た目のデザインは変わりません） */
      padding:30px 20px; background:#fff; text-align:center;
    }
    .footer-icons{
      display:flex; justify-content:center; gap:60px; margin-bottom:16px;
    }
    .footer-icons img{ width:42px; height:42px; }
    .footer-links a{
      display:inline-block; margin:0 20px; color:#444; font-size:24px; text-decoration:none;
    }
    .footer-links a:hover{ text-decoration:underline; }

    .subtitle1 {
      font-family: 'Tangerine', cursive;
      font-size: 100px;
      text-align: center;
      opacity: 0.4;
      margin-top: -30px;
      margin-bottom: 10px;
    }

    /* ===== 上部フィルタ & カテゴリ ===== */
    .top-row .categories{
      display:flex;
      gap:20px;
      padding:18px 0 36px;
      overflow-x:auto;
      white-space:nowrap;
      -webkit-overflow-scrolling:touch;
      scrollbar-width:none;
      flex-wrap:nowrap;
      margin-top: 50px;
    }
    .top-row .categories::-webkit-scrollbar{ display:none; }
    .top-row .categories button{ font-family: 'Lustria;
      flex:0 0 auto;
      font-size:38px;
      padding:15px 80px;
      background:#F564A9;
      border:px solid #999;
      border-radius:60px;
      font-weight:500;
      color:#fff;
opacity:;
      box-shadow:1px 1px 6px rgba(0,0,0,.1);
    }

    /* ===== 商品カード ===== */
    .product-item{display:flex;margin-left:20px;gap:48px;align-items:flex-start;padding:20px 10px;border-bottom:1px solid #e7cfd8}
    .product-img{width:286px;height:286px;object-fit:cover;border-radius:16px;display:block;cursor:pointer}

    .product-right{flex:1;display:flex;flex-direction:column;min-width:0; position:relative;}

    .title-row{display:flex;align-items:center;justify-content:flex-start;margin-top:0px}

.product-name{
 font-family: 'Lustria', serif;
  font-size: 48px;
  font-weight: 400;
  color: #333;

  display:flex;
  flex-direction:column;
  width:100%;
  position: relative;
  top: 44px;   /* 下に10px */
  }

   /* カテゴリーネーム（属名など） */
.category-name {
  color: #555;
margin-bottom:px;
}

/* バリエティーネーム（品種名） */
.variety-name {
  
   /* 左マージン自動で右端に寄せる */
  text-align: right;       /* 内部テキストも右寄せ */
  white-space: nowrap;     /* 折り返しなし */
  direction: ltr;          /* 文字順は通常のまま（重要） */
margin-top:-10px;
}

    .mid{margin:10px 0 12px;display:flex;align-items:center;justify-content:space-between;gap:12px}

    .price{font-size:38px;font-weight:400;margin-top:20px; position: relative;
  top: 30px;  font-family: 'DM Serif Text', serif;}

    .info-btn{margin-top:-100px;width:48px;height:48px;border-radius:50%;border:2px solid #cfcfcf;background:#fff0f5;color:#7a7a7a;font-size:22px;font-weight:bold;display:flex;align-items:center;justify-content:center;flex:0 0 auto}

    .bottom-row{margin-top:30px;display:flex;align-items:center;gap:40px;flex-wrap:nowrap}
 .like-btn{width:66px;height:66px;border-radius:50%;border:2px solid #e91e63;background:none;color:#e91e63none;font-size:34px;display:flex;align-items:center;justify-content:center;cursor:pointer;flex:0 0 auto}
    .like-btn.liked{background:#F564A9;color:#fff}

    /* --- 数量（ネイティブselectは保持するが非表示） --- */
    .qty-wrap{flex:0 0 auto; position:relative;}
    .qty-select{display:none;}

    .qty-display{
      height:65px; padding:0 50px; width:150px;
      border:1px solid #e7e7e7; border-radius:16px; background:#fff;
      font-size:33px; line-height:65px; text-align:center; cursor:pointer;
      position:relative;
    }
    .qty-display::after{
      content:""; position:absolute; right:18px; top:50%; width:8px; height:8px;
      transform:translateY(-50%) rotate(45deg);
      border-right:2px solid #888; border-bottom:2px solid #888;
    }

    .qty-menu{
      position:absolute; left:0; top:0;
      width:150px; max-height:350px; overflow:auto;
      background:#fff; border:2px solid #e7e7e7; border-radius:14px;
      box-shadow:0 6px 18px rgba(0,0,0,.08); display:none; z-index:30;
    }
    .qty-menu.show{display:block;}
    .qty-item{padding:10px 0; text-align:center; font-size:33px; cursor:pointer;}
    .qty-item:hover{background:#f6f6f6}

    .add-btn{
      height:65px !important;
      min-width:180px !important;
      padding:0 50px !important;
      border:px solid #999;
      border-radius:28px;
      background:#F564A9;
      color:#fff;
opacity:;
      font-weight:500;
      font-size:30px !important;
      line-height:65px;
      white-space:nowrap;
      cursor:pointer;
      flex:0 0 auto;
    }



    /* モーダル（画像拡大） */
    #modal{display:none;position:fixed;inset:0;z-index:10;background:rgba(0,0,0,.7)}
    #modal img{display:block;max-width:80%;max-height:80%;margin:200px auto 50px;border:4px solid #fff}

    /* iPhone幅の微調整 */
    @media (max-width:480px){
      .product-name{font-size:34px}
      .price{font-size:32px}
      .subtext{font-size:22px}
      .add-btn{font-size:20px}
      .info-panel{ position:static; width:100%; max-height:none; overflow:visible; }
    }


/* いいねボタンの枠線だけをグレーに */
.like-btn {
  border: 1px solid #999; /* 枠だけグレー */
  color: inherit;         /* 中身の色は変えない */
  background: none;       /* 背景も変えない */
}

 .info-panel{
      position:absolute; right:0; top:0; width:60%; left: 180px;
      display:none; z-index:10;
      background:transparent; border:none; box-shadow:none; padding:0; margin:0;
      color:#333; font-size:18px; line-height:1.5;bottom: 50px;
      max-height:none;min-width:300px; overflow:auto;margin-top: 
    }
    .info-panel.show{ display:block; }
    .info-list{margin:0 ; padding:0; list-style:none;  position: relative;top:20px;left:40px;}
    .info-list li{ margin:9px 0; padding-left:2em; text-indent:-1em; }
    .info-list li::before{ content:"・"; }

    .info-btn { background:#fff !important; margin-top:30px; }
  

/* いいね未選択（♡）の文字色だけグレーに */
.like-btn:not(.liked) { color:#999 !important; }

.category-subtitle {
  font-size: 48px;
  font-family: 'Playfair Display SC', serif;
  margin: 66px 0 10px;
  color: #000000;
  font-weight: 400;
  border-bottom: 1px solid rgba(0,0,0,0.1);
  padding-bottom: 4px;
text-align:center;
}
.contact-links a {
  color: #000;     
  text-decoration: none; /* 下線消し */
}

    .img-track{
      width:286px; height:286px; border-radius:16px; overflow:auto;
      scroll-snap-type:x mandatory;
      display:flex; gap:0;
      -webkit-overflow-scrolling:touch;
      scrollbar-width:none;
    }
    .img-track::-webkit-scrollbar{ display:none; }

    .img-track .product-img{
      flex:0 0 286px; height:286px; object-fit:cover; border-radius:16px;
      scroll-snap-align:start; display:block; cursor:pointer;
    }

    /* ドット（固定配置） */
.img-pager{
  position: static;              /* ← 通常フローに戻す（画像の直後＝真下） */
  width: 286px;
  display: flex; gap: 8px; justify-content: center; align-items: center;
  margin-top: 8px;               /* 見切れ防止の最小スペース（数値は据え置きOK） */
}
    .img-pager .dot{
      width: 8px; height: 8px; border-radius: 50%;
      background:#ccc; opacity:.7;
    }
    .img-pager .dot.active{ background:#333; opacity:1; }

    /* 画像ラッパー（下寄せ） */
.img-wrapper{
  width: 286px;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: center;    /* ← 子要素（トラックとドット）を中央に */
  align-self: stretch;
  /* 無効だった padding-bottom: px は削除（見た目不変） */
}

  </style>



























</head>
<body>
  <div class="header-bar" id="titleBar">
    <button class="menu-icon" onclick="toggleMenu(event)">
      <span></span><span></span><span></span>
    </button>
    <div class="main-title" onclick="window.top.location.href='<?= url ?>?page=index'">nursery sera</div>
    <button class="cart-button" onclick="go('/?page=cart')"></button>
  </div>

  <!-- スライドメニュー -->
  <div class="category-menu" id="categoryMenu">
    <h1 class="category-header">MENU</h1>
<h2 class="category-subtitle">Category</h2>
    <ul>
      <li onclick="go('/?page=index')">All</li>
      <li onclick="go('/?page=index&liked=1')">like♡</li>
      <li onclick="go('/?page=index&cat=monstera')">Monstera</li>
      <li onclick="go('/?page=index&cat=alocasia')">Alocasia</li>
      <li onclick="go('/?page=index&cat=anthurium')">Anthurium</li>
      <li onclick="go('/?page=index&cat=philodendron')">Philodendron</li>
</ul>
<h2 class="category-subtitle">Contact</h2>
<ul class="contact-links">
  <li><a href="https://www.instagram.com/nursery_sera?igsh=cWx2cTZ3cWNicGlz&utm_source=" target="_blank">Instagram</a></li>
  <li><a href="https://lin.ee/mFSu5FS" target="_blank">LINE</a></li>
  <li><a href="https://www.threads.net/@nursery_sera?igshid=NTc4MTIwNjQ2YQ==" target="_blank">Threads</a></li>
  <li><a href="/?page=policy">お問い合わせ</a></li>
</ul>
  </div>
  <div class="overlay" id="overlay" onclick="closeMenu()"></div>

  <main>
    <p class="subtitle1">plant list</p>

    <!-- 上部ボタン & カテゴリ -->
    <section class="container top-row">
      <div id="topCategories" class="categories">
        <button class="pill" onclick="filterCategory('all')">All</button>
 <button class="like-only" onclick="filterLiked()" title="いいねだけ">like♡</button>
        <button onclick="filterCategory('monstera')">Monstera</button>
        <button onclick="filterCategory('alocasia')">Alocasia</button>
        <button onclick="filterCategory('anthurium')">Anthurium</button>
        <button onclick="filterCategory('philodendron')">Philodendron</button>
      </div>
    </section>

    <!-- 商品カード（既存1件はそのまま） -->
    <section class="container">
      <!-- ▼▼▼ ここに追加商品がReactで入る ▼▼▼ -->
      <div id="product-root"></div>
      <!-- ▲▲▲ ここに追加商品がReactで入る ▲▲▲ -->
    </section>

    <!-- 画像拡大モーダル -->
    <div id="modal" onclick="this.style.display='none'"><img id="modal-img" src=""></div>
  </main>

  <!-- フッター -->
  <footer>
<div class="footer-icons">
  <a href="https://www.instagram.com/nursery_sera?igsh=cWx2cTZ3cWNicGlz&utm_source=" target="_blank">
    <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram">
  </a>

  <a href="https://lin.ee/mFSu5FS" target="_blank">
    <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" alt="LINE">
  </a>

  <a href="https://www.threads.net/@nursery_sera?igshid=NTc4MTIwNjQ2YQ==" target="_blank">
    <img src="https://cdn.simpleicons.org/threads/000000" alt="Threads">
  </a>
</div>
    <div class="footer-links">
      <a href="<?= url ?>?page=form"></a>
      <a href="/?page=policy">お問い合わせ</a>
      <a href="/?page=policy">各種ポリシー</a>
      <a href="/?page=policy">利用規約</a>
      <a href="/?page=policy">特定商取引法に基づく表記</a>
    </div>
  </footer>

<script>
  /* ===== 元のJS（関数は変更しない） ===== */
  const BASE = window.location.origin;
  function go(path){
    window.location.href = new URL(path, BASE).toString();
  }

  function toggleMenu(event){
    const menu = document.getElementById("categoryMenu");
    const overlay = document.getElementById("overlay");
    const isVisible = menu.classList.contains("show");
    document.body.style.overflow = isVisible ? "" : "hidden";
    menu.classList.toggle("show", !isVisible);
    overlay.classList.toggle("show", !isVisible);
  }
  function closeMenu(){
    document.getElementById("categoryMenu").classList.remove("show");
    document.getElementById("overlay").classList.remove("show");
    document.body.style.overflow = "";
  }

  let lastScrollY = window.scrollY;
  const titleBar = document.getElementById("titleBar");
  const threshold = 10;
  window.addEventListener("scroll", () => {
    const current = window.scrollY;
    const diff = current - lastScrollY;
    if (Math.abs(diff) < threshold) return;
    titleBar.style.top = (diff < 0) ? "-50px" : "-200px";
    lastScrollY = current;
  });

  function enlargeImage(img){
    const m=document.getElementById('modal'), mi=document.getElementById('modal-img');
    mi.src=img.src; m.style.display='block';
  }

  // ===== カテゴリフィルタ（.category-name の文字で判定） =====
  function filterCategory(category){
    const likes = JSON.parse(localStorage.getItem('likes') || '{}');
    const target = String(category || '').toLowerCase();

    document.querySelectorAll('.product-item').forEach(item=>{
      // .category-name のテキストを使ってカテゴリ判定
      const cnameEl = item.querySelector('.category-name');
      const itemCategory = (cnameEl?.textContent || '').trim().toLowerCase();

      // like用のID（data-id が無ければボタンIDから取得）
      let itemId = item.getAttribute('data-id');
      if (!itemId) {
        const likeBtn = item.querySelector('.like-btn[id^="like-"]');
        if (likeBtn) itemId = likeBtn.id.replace('like-','');
      }

      if (target === 'all') {
        item.style.display = 'flex';
      } else if (target === 'liked') {
        item.style.display = (itemId && likes[itemId]) ? 'flex' : 'none';
      } else {
        item.style.display = (itemCategory === target) ? 'flex' : 'none';
      }
    });
  }
  window.filterCategory = filterCategory; // HTMLから呼べるように公開

  function filterLiked(){
    const likes=JSON.parse(localStorage.getItem('likes')||'{}');
    document.querySelectorAll('.product-item').forEach((it,idx)=>{
      const id=String(idx+1).padStart(3,'0');
      it.style.display = likes[id] ? 'flex' : 'none';
    });
  }
  window.filterLiked = filterLiked;

  function toggleLike(shortId){
    const likes=JSON.parse(localStorage.getItem('likes')||'{}');
    const id='like-'+shortId;
    const btn=document.getElementById(id);
    const liked = !likes[shortId];
    likes[shortId]=liked;
    localStorage.setItem('likes',JSON.stringify(likes));
    btn.classList.toggle('liked', liked);
    btn.textContent = liked ? '♥' : '♡';
  }

function addToCart(id, name, price){
  const sel = document.getElementById('qty-'+id);
  const q = parseInt(sel?.value || '1') || 1;

  // カードDOMから画像・カテゴリ・バリエティを拾う
  const card     = document.querySelector(`[id="qty-${id}"]`)?.closest('.product-item');
  const img      = card?.querySelector('.product-img')?.getAttribute('src') || '';
  const category = (card?.querySelector('.category-name')?.textContent || '').trim();
  const variety  = (card?.querySelector('.variety-name')?.textContent  || '').trim();

  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  const idx  = cart.findIndex(i => i.id === id);

  // 2つ目のカートが期待する形に合わせて保存
  const item = {
    id,
    name    : variety || name || '',        // 後方互換で name も残す
    price   : Number(price) || 0,
    quantity: q,
    image   : img,
    category,
    variety
  };

  if (idx > -1) cart[idx] = item; else cart.push(item);
  localStorage.setItem('cart', JSON.stringify(cart));

  alert(`${variety || name} を ${q} 株カートに追加しました。`);
}

  // ===== infoボタン（i）でパネルの開閉 =====
  document.querySelectorAll('.info-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const card = btn.closest('.product-right');
      const panel = card?.querySelector('.info-panel');
      const subTxt = card?.querySelector('.subtext');
      if(!panel) return;
      document.querySelectorAll('.info-panel.show').forEach(p=>{
        if(p!==panel) p.classList.remove('show');
      });
      if(subTxt){
        panel.style.top = subTxt.offsetTop + 'px';
      }else{
        const mid = card?.querySelector('.mid');
        if(mid) panel.style.top = mid.offsetTop + 'px';
      }
      panel.classList.toggle('show');
      btn.setAttribute('aria-expanded', panel.classList.contains('show'));
    });
  });

  // ===== 数量セレクタの初期化（既存カード用） =====
  document.addEventListener('DOMContentLoaded', ()=>{
    document.querySelectorAll('.qty-select').forEach(sel=>{
      sel.innerHTML='';
      for(let i=1;i<=100;i++){
        const op=document.createElement('option');
        op.value=i; op.textContent=i;
        sel.appendChild(op);
      }
      // localStorage(cart) から数量復元（なければ1）
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const pid = sel.id.replace('qty-','');
      const cartItem = cart.find(i => i.id === pid);
      sel.value = String(cartItem ? (cartItem.quantity || 1) : 1);
      // qty-display の表示も同期
      const display = document.querySelector(`.qty-display[data-for="${sel.id}"]`);
      if (display) display.textContent = sel.value;
    });

    document.querySelectorAll('.qty-display').forEach(btn=>{
      const forId = btn.getAttribute('data-for');
      const sel = document.getElementById(forId);
      const menu = btn.parentElement.querySelector(`.qty-menu[data-for="${forId}"]`);
      if(menu && menu.children.length===0){
        for(let i=1;i<=100;i++){
          const it=document.createElement('div');
          it.className='qty-item';
          it.textContent=i;
          it.addEventListener('click', ()=>{
            sel.value=String(i);
            btn.textContent=String(i);
            menu.classList.remove('show');
          });
          menu.appendChild(it);
        }
      }
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        document.querySelectorAll('.qty-menu.show').forEach(m=>{ if(m!==menu) m.classList.remove('show'); });
        menu.classList.toggle('show');
      });
    });

    document.addEventListener('click', ()=>{
      document.querySelectorAll('.qty-menu.show').forEach(m=>m.classList.remove('show'));
    });
  });

  // ===== 商品名の自動フィット =====
  (function(){
    const MIN_PX = 14;
    function fitName(el){
      let size = parseFloat(getComputedStyle(el).fontSize);
      let guard = 60;
      while (el.scrollWidth > el.clientWidth && size > MIN_PX && guard-- > 0){
        size -= 1;
        el.style.fontSize = size + 'px';
      }
    }
    function fitAll(){
      document.querySelectorAll('.product-name').forEach(el=>{
        el.style.fontSize = '';
        fitName(el);
      });
    }
    document.addEventListener('DOMContentLoaded', fitAll);
    window.addEventListener('load', fitAll);
    window.addEventListener('resize', fitAll);
  })();

  /* ===== GAS依存を静的環境で吸収する“互換シム” ===== */
  (function(){
    // 1) main-title の GAS 依存 onclick を上書き
    const title = document.querySelector('.main-title');
    if (title) {
      title.addEventListener('click', function(ev){
        ev.preventDefault();
        try { go('/?page=index'); } catch(e){ window.location.href='/?page=index'; }
      }, { once:true });
    }

    // 2) href の <?= url ?> を /?page=... に変換
    document.querySelectorAll('a[href*="<?= url ?>"]').forEach(a=>{
      const href = a.getAttribute('href');
      const m = href.match(/\?page=.*$/);
      a.setAttribute('href', m ? m[0] : '/');
    });

    // 3) 空の a[href^='<?= url ?>'] は無効化
    document.querySelectorAll('a[href^="<?= url ?>"]').forEach(a=>{
      if (!a.textContent.trim()) {
        a.setAttribute('tabindex','-1');
        a.style.pointerEvents = 'none';
      }
    });

    // 4) 同一タブで遷移
    const base = document.querySelector('base');
    if (base) base.setAttribute('target','_self');
  })();

  // ===== like の見た目復元 =====
  document.addEventListener('DOMContentLoaded', () => {
    const likes = JSON.parse(localStorage.getItem('likes') || '{}');
    Object.entries(likes).forEach(([shortId, liked]) => {
      const btn = document.getElementById('like-' + shortId);
      if (!btn) return;
      btn.classList.toggle('liked', !!liked);
      btn.textContent = liked ? '♥' : '♡';
    });
  });

  // ===== カテゴリメニュー（サイド/上部）の連携 =====
  document.addEventListener('DOMContentLoaded', () => {
    // 表示名→内部キーの対応（大文字小文字は無視）
    const map = {
      'all': 'all',
      'monstera': 'monstera',
      'alocasia': 'alocasia',
      'anthurium': 'anthurium',
      'philodendron': 'philodendron',
      'liked': 'liked'
    };

    // （※上部の横スクロールに .category-btn があれば拾う：無くても無害）
    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const category = btn.getAttribute('data-category');
        filterCategory(category);
        updateURL(category);
      });
    });

    // ハンバーガーメニューの li をクリックでフィルタ
    const menu = document.getElementById('categoryMenu');
    if (menu) {
      menu.querySelectorAll('li').forEach(li => {
        let category = (li.getAttribute('data-category') || '').trim().toLowerCase();

        if (!category) {
          const txt = (li.textContent || '').trim().toLowerCase();
          if (txt.includes('♡') || txt.includes('♥')) category = 'liked';
          else if (map[txt]) category = txt;
        }

        if (!category) {
          const oc = li.getAttribute('onclick') || '';
          const m1 = oc.match(/cat=([a-z]+)/i);
          const m2 = oc.match(/liked=1/);
          if (m1 && map[m1[1].toLowerCase()]) category = m1[1].toLowerCase();
          if (m2) category = 'liked';
        }

        if (!category) return;

        // 既存の go(...) を無効化して、その場でフィルタ
        li.removeAttribute('onclick');
        li.onclick = null;

        li.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          filterCategory(category);
          updateURL(category);
          if (typeof closeMenu === 'function') closeMenu();
          document.getElementById('topCategories')?.scrollIntoView({ behavior:'smooth', block:'nearest' });
        }, { capture:true });
      });
    }

    // 現在の絞り込みに合わせてURLだけ更新（リロードなし）
    function updateURL(category){
      const url =
        category === 'all'   ? '/?page=index' :
        category === 'liked' ? '/?page=index&liked=1' :
                               `/?page=index&cat=${encodeURIComponent(category)}`;
      history.replaceState(null, '', url);
    }

    // 直アクセス（/?page=index&liked=1 or &cat=...）時にも反映
    const params = new URLSearchParams(location.search);
    if (params.get('liked') === '1') {
      filterCategory('liked');
    } else {
      const initCat = (params.get('cat') || 'all').toLowerCase();
      filterCategory(map[initCat] ? initCat : 'all');
    }
  });

  // ===== 画像のページドット（静的に最初からあるカード用） =====
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.img-wrapper').forEach((wrap) => {
      const track = wrap.querySelector('.img-track');
      const pager = wrap.querySelector('.img-pager');
      if (!track || !pager) return;

      const imgs = track.querySelectorAll('.product-img');
      if (!imgs.length) return;

      // ドット生成
      pager.innerHTML = '';
      imgs.forEach((_, i) => {
        const dot = document.createElement('span');
        dot.className = 'dot' + (i === 0 ? ' active' : '');
        dot.addEventListener('click', () => {
          const w = imgs[0].getBoundingClientRect().width;
          track.scrollTo({ left: i * w, behavior: 'smooth' });
        });
        pager.appendChild(dot);
      });

      // スクロール位置から active 同期
      const updateActive = () => {
        const w = imgs[0].getBoundingClientRect().width || 1;
        const idx = Math.round(track.scrollLeft / w);
        pager.querySelectorAll('.dot').forEach((d, j) => {
          d.classList.toggle('active', j === idx);
        });
      };

      track.addEventListener('scroll', () => requestAnimationFrame(updateActive));
      window.addEventListener('resize', updateActive);
      updateActive();
    });
  });
</script>

<!-- ===== React (UMD) を追加 ===== -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

<!-- ===== Firebaseで取得 → Reactで商品だけ描画（既存CSS/関数は不変更） ===== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // あなたのFirebase設定
  const firebaseConfig = {
    apiKey: "AIzaSyCVOfVGTlfTGRfpNggT55l3raCqjo7OcBo",
    authDomain: "nursery-9bd14.firebaseapp.com",
    projectId: "nursery-9bd14",
    storageBucket: "nursery-9bd14.firebasestorage.app",
    appId: "1:123851517861:web:42afa474c5b6d62669024c"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  const { useEffect, useRef } = React;

  // varietyName をIDに（英数・日本語対応の簡易スラッグ化）
  const toId = (str, fallback) => {
    const s = (str || '').toString().trim().toLowerCase()
      .replace(/[^\p{L}\p{N}]+/gu, '-')   // 文字以外→ハイフン
      .replace(/^-+|-+$/g, '');           // 先頭末尾のハイフン除去
    return s || (fallback || '');
  };

  // ==== 1商品カード（既存の関数をそのまま呼ぶ）====
  function ProductCard({ d, id }) {
    const imgs  = Array.isArray(d.images) ? d.images.slice(0, 2) : [];
    const price = Number(d.price || 0);

    const trackRef = useRef(null);
    const pagerRef = useRef(null);

    // ページドット（React生成分）
    useEffect(() => {
      const track = trackRef.current;
      const pager = pagerRef.current;
      if (!track || !pager) return;

      const pics = track.querySelectorAll('img.product-img');
      pager.innerHTML = '';
      if (pics.length > 0) {
        pics.forEach((_, i) => {
          const dot = document.createElement('span');
          dot.className = 'dot' + (i === 0 ? ' active' : '');
          dot.addEventListener('click', () => {
            const w = pics[0].getBoundingClientRect().width || 0;
            track.scrollTo({ left: w * i, behavior: 'smooth' });
          });
          pager.appendChild(dot);
        });
        const updateActive = () => {
          const w = pics[0].getBoundingClientRect().width || 1;
          const idx = Math.round(track.scrollLeft / w);
          [...pager.children].forEach((d, j) => d.classList.toggle('active', j === idx));
        };
        track.addEventListener('scroll', () => requestAnimationFrame(updateActive), { passive: true });
        window.addEventListener('resize', updateActive);
        updateActive();
        return () => window.removeEventListener('resize', updateActive);
      }
    }, [id]);

    // いいね＆数量の復元（localStorage）――React生成分にも反映
    useEffect(() => {
      // いいね見た目
      const likes = JSON.parse(localStorage.getItem('likes') || '{}');
      const btnLike = document.getElementById('like-' + id);
      const liked = !!likes[id];
      if (btnLike) {
        btnLike.classList.toggle('liked', liked);
        btnLike.textContent = liked ? '♥' : '♡';
      }

      // 数量（カートに入れてあるものは復元）
      const sel  = document.getElementById(`qty-${id}`);
      const dsp  = document.querySelector(`.qty-display[data-for="qty-${id}"]`);
      const menu = document.querySelector(`.qty-menu[data-for="qty-${id}"]`);

      // option用意
      if (sel && !sel.options.length) {
        for (let i = 1; i <= 100; i++) {
          const op = document.createElement('option'); op.value = i; op.textContent = i;
          sel.appendChild(op);
        }
      }
      // cartから復元（なければ1）
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const ci   = cart.find(i => i.id === id);
      const val  = String(ci ? (ci.quantity || 1) : 1);
      if (sel) sel.value = val;
      if (dsp) dsp.textContent = val;

      // 数量メニューのクリック挙動
      if (menu && !menu.children.length) {
        for (let i = 1; i <= 100; i++) {
          const it = document.createElement('div');
          it.className = 'qty-item'; it.textContent = i;
          it.addEventListener('click', () => {
            if (sel) sel.value = String(i);
            if (dsp) dsp.textContent = String(i);
            menu.classList.remove('show');
          });
          menu.appendChild(it);
        }
      }
      const toggleQtyMenu = (e) => { e.stopPropagation(); menu?.classList.toggle('show'); };
      const dspBtn = dsp?.closest('.qty-wrap')?.querySelector('.qty-display');
      dspBtn?.addEventListener('click', toggleQtyMenu);
      const closeAll = () => menu?.classList.remove('show');
      document.addEventListener('click', closeAll);
      return () => {
        dspBtn?.removeEventListener('click', toggleQtyMenu);
        document.removeEventListener('click', closeAll);
      };
    }, [id]);

    // infoボタン（既存と同じ挙動をReact側で付与）
    const onInfoClick = (e) => {
      const card  = e.currentTarget.closest('.product-right');
      const panel = card?.querySelector('.info-panel');
      const subTxt = card?.querySelector('.subtext');
      if (!panel) return;
      document.querySelectorAll('.info-panel.show').forEach(p => { if (p !== panel) p.classList.remove('show'); });
      if (subTxt) {
        panel.style.top = subTxt.offsetTop + 'px';
      } else {
        const mid = card?.querySelector('.mid');
        if (mid) panel.style.top = mid.offsetTop + 'px';
      }
      panel.classList.toggle('show');
      e.currentTarget.setAttribute('aria-expanded', panel.classList.contains('show'));
    };

    return React.createElement('article',
      { className: 'product-item', 'data-category': (d.categoryName || '').toLowerCase(), 'data-id': id },

      React.createElement('div', { className: 'img-wrapper' },
        React.createElement('div', { className: 'img-track', ref: trackRef },
          (imgs.length ? imgs : ['']).map((src, i) =>
            React.createElement('img', {
              key: i, className: 'product-img',
              src: src || 'data:image/gif;base64,R0lGODlhAQABAAAAACw=',
              alt: `${d.categoryName || ''} ${d.varietyName || ''} #${i + 1}`,
              onClick: (ev) => window.enlargeImage?.(ev.target)
            })
          )
        ),
        React.createElement('div', { className: 'img-pager', ref: pagerRef })
      ),

      React.createElement('div', { className: 'product-right' },
        React.createElement('div', { className: 'title-row' },
          React.createElement('div', { className: 'product-name' },
            React.createElement('div', { className: 'name-spacer' }),
            React.createElement('div', { className: 'category-name' }, d.categoryName || ''),
            React.createElement('div', { className: 'variety-name'  }, d.varietyName  || '')
          )
        ),
        React.createElement('div', { className: 'mid' },
          React.createElement('p', { className: 'price' }, `¥ ${Number(price).toLocaleString()}`),
          React.createElement('button', { className: 'info-btn', 'aria-label': 'info', onClick: onInfoClick }, 'i')
        ),
        React.createElement('div', { className: 'info-panel' },
          React.createElement('ul', { className: 'info-list' }, [
            React.createElement('li', { key: 1 }, '一枚目参考親株'),
            React.createElement('li', { key: 2 }, '二枚目参考TC株'),
            React.createElement('li', { key: 3 }, '画像タップで拡大できます')
          ])
        ),
        React.createElement('div', { className: 'bottom-row' },
          React.createElement('button', {
            className: 'like-btn',
            id: `like-${id}`,
            onClick: () => window.toggleLike?.(id),
            'aria-label': 'like'
          }, '♡'),
          React.createElement('div', { className: 'qty-wrap' },
            React.createElement('select', { id: `qty-${id}`, className: 'qty-select' }),
            React.createElement('div', { className: 'qty-display', 'data-for': `qty-${id}` }, '1'),
            React.createElement('div', { className: 'qty-menu', 'data-for': `qty-${id}` })
          ),
          React.createElement('button', {
            className: 'add-btn',
            onClick: () => window.addToCart?.(id, `${d.categoryName || ''} ${d.varietyName || ''}`, price)
          }, 'Add to Cart')
        )
      )
    );
  }

  function ProductList({ items }) {
    return React.createElement(React.Fragment, null,
      items.map(({ id, data }) => React.createElement(ProductCard, { key: id, id, d: data }))
    );
  }

async function renderProducts() {
  const mount = document.getElementById('product-root');
  if (!mount) return;

  let docs = [];
  try {
    const q = query(collection(db, 'products'), orderBy('createdAt', 'desc'));
    const snap = await getDocs(q);
    docs = snap.docs.map(d => {
      const data = d.data();
      return { id: toId(data.varietyName, d.id), data };
    });
  } catch (e) {
    const snap = await getDocs(collection(db, 'products'));
    docs = snap.docs.map(d => {
      const data = d.data();
      return { id: toId(data.varietyName, d.id), data };
    });
  }

  ReactDOM.createRoot(mount).render(
    React.createElement(ProductList, { items: docs })
  );

  await new Promise(r => requestAnimationFrame(() => requestAnimationFrame(r)));
  document.dispatchEvent(new Event('products-rendered'));
}
  
// ▼▼▼ 追記：描画完了後に URL の cat/liked を反映
// ▼▼▼ React描画完了後に URL の cat/liked を反映（イベントで同期）
const params = new URLSearchParams(location.search);
const want = (params.get('liked') === '1')
  ? 'liked'
  : (params.get('cat') || 'all').toLowerCase();

document.addEventListener('products-rendered', () => {
  window.filterCategory?.(want);
  document.getElementById('topCategories')?.scrollIntoView({
    behavior: 'instant',
    block: 'nearest'
  });
});
  renderProducts().catch(console.error);
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const likeOnlyBtn = document.querySelector('.like-only');
    if (likeOnlyBtn) {
      likeOnlyBtn.onclick = null; // 既存の onclick を無効化
      likeOnlyBtn.addEventListener('click', (e) => {
        e.preventDefault();
        filterCategory('liked'); // ← これで likes の true だけ表示
        history.replaceState(null, '', '/?page=index&liked=1');
      });
    }
  });
</script>
</body>
</html>