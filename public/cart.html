<!DOCTYPE html>
<html lang="ja">
<head>
  <base target="_top">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=950, user-scalable=no">
  <title>nursery sera - カート</title>
  <link href="https://fonts.googleapis.com/css2?family=Bayon&family=Tangerine:wght@700&family=Italianno&family=Noto+Serif+JP&display=swap" rel="stylesheet">
  <style>
  html, body {
      margin: 0;
      padding: 0;
      font-size: 20px;
      -webkit-text-size-adjust: 100%;
      font-family: Arial, sans-serif;
      background: #fff;
      color: #333;
      box-sizing: border-box;
      scroll-behavior: smooth;
      height: 100%;
  }
  body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
  }
  *, *::before, *::after { box-sizing: inherit; }

  .header-bar {
      position: sticky;
      top: -50px;
      z-index: 1000;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      transition: top 0.5s ease;
  }
  .menu-icon {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 48px;
      height: 40px;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      transform: translateX(20px);
  }
  .menu-icon span {
      display: block;
      height: 3px;
      width: 100%;
      background-color: #333;
      border-radius: 2px;
  }
  .main-title {
      font-family: 'Bayon', cursive;
      font-size: 120px;
      margin: 0 ;
      left: 50%;
      white-space: nowrap;
      transform: translateX(20px);
  }
  .cart-button {
      background-image: url('https://gist.githubusercontent.com/nursery-sera/3bfad5863718f7147d193844bdaca462/raw/d7f9244ea2cbbaf4c13a67c30831022e37076b17/plantcart-icon.svg');
      background-size: contain;
      background-repeat: no-repeat;
      width: 100px;
      height: 100px;
      border: none;
      background-color: transparent;
      cursor: pointer;
  }

  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.3);
    z-index: 2000;
    display: none;
  }
  .overlay.show { display: block; }


    .category-menu{
      position:fixed; top:0; left:0;
      width:55vw; height:100vh;
      background-color:rgba(255,255,255,.7);
      backdrop-filter:blur(8px);
      z-index:3000;
      border:2px solid rgba(0,0,0,.1);
      box-shadow:4px 0 20px rgba(0,0,0,.2);
      transform:translateX(-100%); opacity:0; pointer-events:none;
      transition:transform .4s ease, opacity .4s ease;
      padding:30px;
    }
    .category-menu.show{
      transform:translateX(0); opacity:1; pointer-events:auto;
    }

    .category-header{
      font-family:'Cinzel', serif;
      font-size:80px; margin-bottom:40px; letter-spacing:3px; color:#000;
      text-align:center;
    }
    .category-menu ul{ list-style:none; padding:0; margin:0; }
    .category-menu li{opacity: 0.8;
font-family: 'Noto Serif JP', serif;
      font-size:36px; margin:20px 0; padding-bottom:10px; position:relative;
      border-bottom:1px solid rgba(0,0,0,.1);
      transition:transform .2s ease, color .2s ease;
      cursor:pointer; font-weight:400; color:#000!important; text-align:left; padding-right:20px;
    }
    .category-menu li:hover{ color:#c2185b; transform:scale(1.05); }
    .category-menu li::after{
      content:"＞"; position:absolute; right:0; top:2px; color:#bbb; font-size:20px;
    }

.category-subtitle {
  font-size: 48px;
  font-family: 'Playfair Display SC', serif;
  margin: 66px 0 10px;
  color: #000000;
  font-weight: 400;
  border-bottom: 1px solid rgba(0,0,0,0.1);
  padding-bottom: 4px;
text-align:center;
}
.contact-links a {
  color: #000;     
  text-decoration: none; /* 下線消し */
}


  .subtitle1 {
      font-family: 'Tangerine', cursive;
      font-size: 80px;
      text-align: center;
      opacity: 0.7;
      margin-top: -30px;
      margin-bottom: 10px;
  }
  .subtitle2 {
      font-family: 'Cinzel', serif;
      font-size: 48px;
      text-align: center;
      margin: 60px 0 30px;
  }

  .cart-item {
      position: relative;
      display: flex;
      align-items: flex-start;
      gap: 20px;
      margin: 20px 0;
      padding-bottom: 20px;
  }
  .cart-item::after {
    content: "";
    display: block;
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 1px;
    background: #ccc;
  }

  .cart-item img {
      width: 35vw;
      max-width: none;
      cursor: zoom-in;
  }

  .item-info { flex: 1; }



  .item-price {transform: translate(0px, px);
    font-size: 28px;
    margin: 0px 0 0;
opacity:0.9;
  }

  .quantity-control {
    font-size: 28px;
    display: flex;
    align-items: center;
    gap: 0px;
    margin: 10px 0 0;
   opacity:0.9;
  }
  .quantity-control button {
      font-size: 28px;
      border: none;	
      background: none;
      color: #888;
      cursor: pointer;
  }
  .quantity-control input[type="number"] {
      width: 50px;
      text-align: center;
      font-size: 22px;
      border: 1px solid #ccc;
      border-radius: 0px;
      background: none;
color:#888;
  }

  .remove-btn {
      font-size: 25px;
      margin-top: 30px;
      color: #000;
      background: none;
      border: none;
      text-decoration: underline;
      cursor: pointer;
  }

  .container { flex: 1 0 auto; }

  .cart-area { padding: 0 5vw 40px; }

  .total {
      text-align: right;
      padding: 20px;
      font-size: 25px;
      font-weight: bold;
  }

  /* 合計エリアの行 */
  .sum-row{
    display:flex; align-items:flex-start; justify-content:space-between;
    gap:20px; font-size:22px; font-weight:normal; margin:10px 0;
  }
  .sum-row.total{ font-weight:bold; font-size:24px; }
  .sum-hr{ height:1px; background:#ccc; margin:14px 0; }

.cart-actions {
  display: flex;
  flex-direction: column;
  gap: 15px;
  align-items: center; /* 中央揃え */
  padding: 0 20px 40px;
}

.cart-actions .order-btn,
.cart-actions .back-btn {
  background: none;   /* 背景なし */
  border: none;       /* 枠なし */
  padding: 0;         /* 余白なし */
  font-size: 48px;
  font-weight: 200;
  color: inherit;     /* グレー継承 */
  cursor: pointer;

  /* ▼ 下線は0.5pxのボーダーで作る（細い＆オフセット自由） */
  text-decoration: none;
  border-bottom: 1px solid currentColor;
  padding-bottom: 6px;         /* 文字との間隔 */
  margin-top: 50px;

}

  footer {
      margin-top: auto;
      padding: 30px 20px;
      background: #fff0f5;
      text-align: center;
  }
  .footer-icons {
      display: flex;
      justify-content: center;
      gap: 60px;
      margin-bottom: 16px;
  }
  .footer-icons img {
      width: 48px;
      height: 48px;
  }
  .footer-links a {
      display: inline-block;
      margin: 0 20px;
      color: #444;
      font-size: 24px;
      text-decoration: none;
  }
  .footer-links a:hover { text-decoration: underline; }

  /* ---- 全体の文字色をグレー、タイトルだけ黒 ---- */
  body { color:#777; }
  .main-title { color:#000; }

  /* 既存で真っ黒固定にしてた要素は継承させる（グレーに統一） */
  .quantity-control button,
  .remove-btn,
  .category-menu li,
  .footer-links a { color: inherit; }

  /* オプション行：テキスト風セレクト＋矢印は文字 */
  .option-inline{ display:flex; align-items:center; gap:0; }
  .option-select{
    display:inline-block;
    width:auto;
    min-width:0;
    background:transparent;
    border:0;
    outline:0;
    appearance:none; -webkit-appearance:none; -moz-appearance:none;
    padding:0; margin-left:0; cursor:pointer;
    font-size:1em; line-height:1; color:inherit;
  }
  .option-select::-ms-expand{ display:none; }

  /* 矢印はテキスト「∨」でフォント連動・色も連動 */
  .option-caret{
    display:inline-block;
    font-size:1em;
    line-height:1;
    margin-left:0.25em;
    color:inherit;
  }

  /* 選択中テキスト幅を測るための不可視要素 */
  .opt-measure{ position:absolute; visibility:hidden; white-space:nowrap; font-size:1em; }

.item-name{
  font-family: 'Noto Serif JP', serif;
  font-size: 44px;

  color: #333;

  display:flex;
  flex-direction:column;
  width:100%;
  position: relative;
margin-top:-20px;

  }

   /* カテゴリーネーム（属名など） */
.item-category {
  color: #555;
margin-bottom:px;
opacity:0.9;
}

/* バリエティーネーム（品種名） */
.item-variety {
  
   /* 左マージン自動で右端に寄せる */
  text-align: right;       /* 内部テキストも右寄せ */
  white-space: nowrap;     /* 折り返しなし */
  direction: ltr;          /* 文字順は通常のまま（重要） */
margin-top:-10px;
opacity:0.8;
}

  </style>
</head>
<body>

  <? var url = getScriptUrl(); ?>
  <div class="header-bar" id="titleBar">
    <div class="menu-icon" onclick="toggleMenu(event)">
      <span></span><span></span><span></span>
    </div>
    <div class="main-title" onclick="window.top.location.href='<?= url ?>?page=index'">nursery sera</div>
    <button class="cart-button" onclick="window.top.location.href='<?= url ?>?page=cart'"></button>
  </div>

  <div class="category-menu" id="categoryMenu">
    <h1 class="category-header">MENU</h1>
<h2 class="category-subtitle">Category</h2>
    <ul>
      <li onclick="go('/?page=index')">All</li>
      <li onclick="go('/?page=index&liked=1')">like♡</li>
      <li onclick="go('/?page=index&cat=monstera')">Monstera</li>
      <li onclick="go('/?page=index&cat=alocasia')">Alocasia</li>
      <li onclick="go('/?page=index&cat=anthurium')">Anthurium</li>
      <li onclick="go('/?page=index&cat=philodendron')">Philodendron</li>
</ul>
<h2 class="category-subtitle">Contact</h2>
<ul class="contact-links">
  <li><a href="https://www.instagram.com/nursery_sera?igsh=cWx2cTZ3cWNicGlz&utm_source=" target="_blank">Instagram</a></li>
  <li><a href="https://lin.ee/mFSu5FS" target="_blank">LINE</a></li>
  <li><a href="https://www.threads.net/@nursery_sera?igshid=NTc4MTIwNjQ2YQ==" target="_blank">Threads</a></li>
  <li><a href="/?page=form">お問い合わせ</a></li>
</ul>
  </div>
  <div class="overlay" id="overlay" onclick="closeMenu()"></div>

  <p class="subtitle1">Order Summary</p>
  <p class="subtitle2"></p>

  <div class="container">
    <div class="cart-area">
      <div id="cartContainer"></div>

      <!-- 小計〜合計（オプション: プルダウン） -->
      <div id="totalPrice" class="total"></div>

      <div class="cart-actions">
        <button class="order-btn" onclick="goToOrder()">この内容で注文する ></button>
        <button class="back-btn" onclick="goToindex()">< 商品一覧に戻る</button>
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-icons">
       <a href="https://www.instagram.com/nursery_sera?igsh=cWx2cTZ3cWNicGlz&utm_source=" target="_blank">
    <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram">
  </a>

  <a href="https://lin.ee/mFSu5FS" target="_blank">
    <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" alt="LINE">
  </a>

  <a href="https://www.threads.net/@nursery_sera?igshid=NTc4MTIwNjQ2YQ==" target="_blank">
    <img src="https://cdn.simpleicons.org/threads/000000" alt="Threads">
  </a>
    </div>
    <div class="footer-links">
      <a href="<?= url ?>?page=policy">各種ポリシー</a>
      <a href="<?= url ?>?page=policy">利用規約</a>
      <a href="<?= url ?>?page=policy">特定商取引法に基づく表記</a>
      <a href="<?= url ?>?page=policy">お問い合わせ</a>
    </div>
  </footer>

  <div id="imageModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:9999; justify-content:center; align-items:center;" onclick="closeImageModal()">
    <img id="modalImage" src="" style="max-width:90vw; max-height:90vh; border:5px solid white; border-radius:10px;">
  </div>

  <script>
  const BASE = window.location.origin;
  function go(path){ window.top.location.href = new URL(path, BASE).toString(); }

    function toggleMenu(event) {
      const menu = document.getElementById("categoryMenu");
      const overlay = document.getElementById("overlay");
      const isVisible = menu.classList.contains("show");
      if (!isVisible) {
        document.body.style.overflow = "hidden";
      } else {
        document.body.style.overflow = "";
      }
      menu.classList.toggle("show", !isVisible);
      overlay.classList.toggle("show", !isVisible);
    }
    function closeMenu() {
      document.getElementById("categoryMenu").classList.remove("show");
      document.getElementById("overlay").classList.remove("show");
      document.body.style.overflow = "";
    }

    function loadCart() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const container = document.getElementById("cartContainer");
      const totalEl = document.getElementById("totalPrice");
      container.innerHTML = "";
      let subtotal = 0;

      if (cart.length === 0) {
        container.innerHTML = "<p style='text-align:center'>カートは空です。</p>";
        totalEl.innerHTML = "";
        return;
      }

      cart.forEach((item, i) => {
        const div = document.createElement("div");
        div.className = "cart-item";
        const quantity = item.quantity || 1;
        subtotal += item.price * quantity;

        div.innerHTML = `
          <img src="${item.image || ''}" onclick="openImageModal('${item.image || ''}')">
          <div class="item-info">
            <p class="item-name">
  <span class="item-category">${item.category || ''}</span>
  <span class="item-variety">${item.variety || item.name || ''}</span>
</p>
            <p class="item-price">価格　：　¥${(item.price * quantity).toLocaleString()}（税込）</p>
            <div class="quantity-control">
              <span class="quantity-label">数量　：</span>
              <button onclick="changeQuantity(${i}, -1)">−</button>
              <input type="number" min="1" value="${quantity}" onchange="updateQuantity(${i}, this.value)">
              <button onclick="changeQuantity(${i}, 1)">＋</button>
            </div>
            <button class="remove-btn" onclick="removeItem(${i})">✖削除</button>
          </div>
        `;
        container.appendChild(div);
      });

      // サマリー（プルダウン式オプション・送料行・案内文）
      totalEl.innerHTML = `
        <div class="sum-row"><span>小計</span><span id="sum-subtotal">¥0</span></div>

        <div class="sum-row" style="align-items:center;">
          <div class="option-inline" style="white-space:nowrap; position:relative;">
            <label>配送オプション</label>
            <span id="opt-measure" class="opt-measure"></span>
            <select id="opt-select" class="option-select">
              <option value="0">選択</option>
<option value="0">なし</option>
              <option value="300">ヤマト運輸 +300円</option>
              <option value="160">第四種郵便+特定記録(追跡番号付き) +160円</option>
            </select>
            <span class="option-caret" aria-hidden="true">∨</span>
          </div>
          <span id="opt-cost" style="min-width:6em; text-align:right;">¥0</span>
        </div>

        <div class="sum-row">
          <span>送料</span>
          <span id="sum-shipping">¥0</span>
        </div>

        <div class="sum-hr"></div>

        <div class="sum-row total">
          <span>注文合計金額</span>
          <span id="sum-total">¥0</span>
        </div>

        <div style="text-align:left; font-size:20px; line-height:1.7; font-weight:200; margin-top:14px;">
          <div>※発送方法：第四種郵便 速達 特定記録（追跡番号付き）</div>
          <div>※お支払い方法：銀行振込（PayPay銀行）</div>
          <div>※注文金額が10,000円以上で送料無料</div>
          <div>※5,000円以上で送料半額</div>
          <div>※通常送料：700円</div>
          <div>※局留め希望の方は、配送先入力フォームの備考欄に「〇〇郵便局 局留め」と記載してください。</div>
        </div>
      `;

      // 初期反映
      updateSummaryNumbers(subtotal);
      sizeOption(); // 追加：選択テキスト幅に合わせてセレクトを縮める

      // 変更イベント
      const sel = document.getElementById('opt-select');
      sel && sel.addEventListener('change', () => {
        sizeOption();                 // 選択変更時も幅を更新
        updateSummaryNumbers(subtotal);
      });
    }

    // 送料の基本計算（小計で変化）
    function calcBaseShipping(subtotal){
      if (subtotal >= 10000) return 0;
      if (subtotal >= 5000)  return 350;
      return 700;
    }
    function yen(n){ return '¥' + Number(n||0).toLocaleString(); }

    function updateSummaryNumbers(subtotal){
      const sel = document.getElementById('opt-select');
      const addOpt = sel ? Number(sel.value) : 0;
      const shipping = calcBaseShipping(subtotal);

      const sumSubtotal = document.getElementById('sum-subtotal');
      const sumShipping = document.getElementById('sum-shipping');
      const sumTotal    = document.getElementById('sum-total');

      if(sumSubtotal) sumSubtotal.textContent = yen(subtotal);
      if(sumShipping) sumShipping.textContent = yen(shipping);
      if(sumTotal)    sumTotal.textContent    = yen(subtotal + shipping + addOpt);
      const optCost = document.getElementById('opt-cost');
      if (optCost) optCost.textContent = yen(addOpt);
    }

    // 選択中テキスト幅に応じて select を縮め、直後の「∨」を常に真横に配置
    function sizeOption(){
      const sel = document.getElementById('opt-select');
      const meter = document.getElementById('opt-measure');
      if(!sel || !meter) return;
      const cs = getComputedStyle(sel);
      meter.style.font = cs.font;
      meter.textContent = sel.options[sel.selectedIndex].text;
      sel.style.width = (meter.offsetWidth + 2) + 'px';
    }

    function changeQuantity(index, delta) {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      cart[index].quantity = (cart[index].quantity || 1) + delta;
      if (cart[index].quantity < 1) cart[index].quantity = 1;
      localStorage.setItem('cart', JSON.stringify(cart));
      loadCart();
    }

    function updateQuantity(index, value) {
      const qty = parseInt(value);
      if (isNaN(qty) || qty < 1) return;
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      cart[index].quantity = qty;
      localStorage.setItem('cart', JSON.stringify(cart));
      loadCart();
    }

    function removeItem(index) {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      cart.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      loadCart();
    }
    
    // 小計だけ計算（subtotalだけ使い回したいとき用）
function getCartSubtotal(){
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  return cart.reduce((s, it) => s + Number(it.price || 0) * Number(it.quantity || 1), 0);
}

+    // 注文ボタン：遷移直前に「合計情報のスナップショット」を保存してから order へ
+    function goToOrder() {
+      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
+      if (cart.length === 0) {
+        alert("カートが空です");
+        return;
+      }
+      // 小計を計算（画面表示と同じ計算）
+      const subtotal = cart.reduce((s, it) => s + Number(it.price || 0) * Number(it.quantity || 1), 0);
+      // 送料の基本（画面と同じロジック）
+      const baseShipping = calcBaseShipping(subtotal);
+      // 追加オプション（セレクトの値）
+      const sel = document.getElementById('opt-select');
+      const addOpt = sel ? Number(sel.value || 0) : 0;
+      // 合計
+      const total = subtotal + baseShipping + addOpt;
+      // 画面で選ばれた配送オプションの文言（送信用メモ）
+      const addOptText = sel ? sel.options[sel.selectedIndex].text : '';
+      // 支払い方法（固定メモ：銀行振込）
+      const paymentMethod = 'bank_transfer'; // （ばんく・とらんすふぁー：銀行振込）
+      // 保存（order.html で読み出してAPIへPOST）
+      const checkout = {
+        subtotal, baseShipping, addOpt, total,
+        addOptText,
+        paymentMethod
+      };
+      localStorage.setItem('checkout', JSON.stringify(checkout));
+      // そのまま order へ（同一タブ）
+      window.top.location.href = '<?= url ?>?page=order';
+    }
    function goToindex() {
      window.top.location.href = '<?= url ?>?page=index';
    }

    function openImageModal(url) {
      const modal = document.getElementById("imageModal");
      const img = document.getElementById("modalImage");
      img.src = url;
      modal.style.display = "flex";
    }

    function closeImageModal() {
      document.getElementById("imageModal").style.display = "none";
    }

    window.onload = loadCart;

    let lastScrollY = window.scrollY;
    const titleBar = document.getElementById("titleBar");
    const threshold = 10;

    window.addEventListener("scroll", () => {
      const currentScrollY = window.scrollY;
      const diff = currentScrollY - lastScrollY;
      if (Math.abs(diff) < threshold) return;
      titleBar.style.top = diff < 0 ? "-50px" : "-200px";
      lastScrollY = currentScrollY;
    });
  </script>
</body>
</html>
